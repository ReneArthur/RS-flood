<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        *{
            padding: 0px;
            margin: 0px;
        }
        #map {
            height: 600px;
            width: 80%;
        }
    </style>
</head>
<body>
    <nav>
        <a href="#">Flood impact</a>
        <a href="map.html">Map</a>
        <a>Before and after</a>
        <a>Stories</a>
    </nav>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://unpkg.com/georaster"></script>
    <script src="https://unpkg.com/georaster-layer-for-leaflet/dist/georaster-layer-for-leaflet.min.js"></script>
    <script>
        var bounds = [
            [-30.2, -51.5],  
            [-29.7, -50.9]
        ];

        var map = L.map('map', {
            maxBounds: bounds, 
            maxBoundsViscosity: 1.0, 
            // minZoom: 10, 
            // maxZoom: 12 
        }).setView([-30.0, -51.2], 10); 

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var url_to_geotiff_file = "./OPERA_DSWx_HLS_20240506-20240421_FloodMap.tif";

        fetch(url_to_geotiff_file)
        .then(response => response.arrayBuffer())
        .then(arrayBuffer => {
            parseGeoraster(arrayBuffer).then(georaster => {
            console.log("georaster:", georaster);

            /*
                GeoRasterLayer is an extension of GridLayer,
                which means can use GridLayer options like opacity.

                Just make sure to include the georaster option!

                Optionally set the pixelValuesToColorFn function option to customize
                how values for a pixel are translated to a color.

                https://leafletjs.com/reference.html#gridlayer
            */
            var layer = new GeoRasterLayer({
                georaster: georaster,
                opacity: 0.65,
                // pixelValuesToColorFn: values => values[0] === 42 ? '#ffffff' : '#000000',
                pixelValuesToColorFn: values => {
                    if(values[0] === 1) {
                        return "red"
                    }
                },
                resolution: 256 // optional parameter for adjusting display resolution
            });
            layer.addTo(map);

            map.fitBounds(layer.getBounds());

        });
        });
    </script>
</body>
</html>